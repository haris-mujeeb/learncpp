{"id":10562,"date":"2020-12-21T11:29:04","date_gmt":"2020-12-21T19:29:04","guid":{"rendered":"https:\/\/www.learncpp.com\/?p=10562"},"modified":"2024-12-23T21:46:27","modified_gmt":"2024-12-24T05:46:27","slug":"code-coverage","status":"publish","type":"post","link":"https:\/\/www.learncpp.com\/cpp-tutorial\/code-coverage\/","title":{"rendered":"9.2 &#8212; Code coverage"},"content":{"rendered":"<p>In the previous lesson <a href=\"https:\/\/www.learncpp.com\/cpp-tutorial\/introduction-to-testing-your-code\/\">9.1 -- Introduction to testing your code<\/a>, we discussed how to write and preserve simple tests.  In this lesson, we&#8217;ll talk about what kind of tests are useful to write to ensure your code is correct.<\/p>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Code coverage<\/p>\n<p>The term <strong>code coverage<\/strong> is used to describe how much of the source code of a program is executed while testing.  There are many different metrics used for code coverage.  We&#8217;ll cover a few of the more useful and popular ones in the following sections.<\/p>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Statement coverage<\/p>\n<p>The term <strong>statement coverage<\/strong> refers to the percentage of statements in your code that have been exercised by your testing routines.  <\/p>\n<p>Consider the following function:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">int foo(int x, int y)\r\n{\r\n    int z{ y };\r\n    if (x &gt; y)\r\n    {\r\n        z = x;\r\n    }\r\n    return z;\r\n}<\/code><\/pre>\n<p>Calling this function as <code>foo(1, 0)<\/code> will give you complete statement coverage for this function, as every statement in the function will execute.<\/p>\n<p>For our <code>isLowerVowel()<\/code> function:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">bool isLowerVowel(char c)\r\n{\r\n    switch (c) \/\/ statement 1\r\n    {\r\n    case 'a':\r\n    case 'e':\r\n    case 'i':\r\n    case 'o':\r\n    case 'u':\r\n        return true; \/\/ statement 2\r\n    default:\r\n        return false; \/\/ statement 3\r\n    }\r\n}<\/code><\/pre>\n<p>This function will require two calls to test all of the statements, as there is no way to reach statement 2 and 3 in the same function call.<\/p>\n<p>While aiming for 100% statement coverage is good, it&#8217;s often not enough to ensure correctness.<\/p>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Branch coverage<\/p>\n<p><strong>Branch coverage<\/strong> refers to the percentage of branches that have been executed, each possible branch counted separately.  An <code>if statement<\/code> has two branches -- a branch that executes when the condition is <code>true<\/code>, and a branch that executes when the condition is <code>false<\/code> (even if there is no corresponding <code>else statement<\/code> to execute).  A switch statement can have many branches.<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">int foo(int x, int y)\r\n{\r\n    int z{ y };\r\n    if (x &gt; y)\r\n    {\r\n        z = x;\r\n    }\r\n    return z;\r\n}<\/code><\/pre>\n<p>The previous call to foo(1, 0) gave us 100% statement coverage and exercised the use case where <code>x &gt; y<\/code>, but that only gives us 50% branch coverage.  We need one more call, to <code>foo(0, 1)<\/code>, to test the use case where the <code>if statement<\/code> does not execute.<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">bool isLowerVowel(char c)\r\n{\r\n    switch (c)\r\n    {\r\n    case 'a':\r\n    case 'e':\r\n    case 'i':\r\n    case 'o':\r\n    case 'u':\r\n        return true;\r\n    default:\r\n        return false;\r\n    }\r\n}<\/code><\/pre>\n<p>In the isLowerVowel() function, two calls will be needed to give you 100% branch coverage: one (such as <code>isLowerVowel('a')<\/code>) to test the first cases, and another (such as <code>isLowerVowel('q')<\/code>) to test the default case.  Multiple cases that feed into the same body don&#8217;t need to be tested separately -- if one works, they all should.<\/p>\n<p>Now consider the following function:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">void compare(int x, int y)\r\n{\r\n\tif (x &gt; y)\r\n\t\tstd::cout &lt;&lt; x &lt;&lt; \" is greater than \" &lt;&lt; y &lt;&lt; '\\n'; \/\/ case 1\r\n\telse if (x &lt; y)\r\n\t\tstd::cout &lt;&lt; x &lt;&lt; \" is less than \" &lt;&lt; y &lt;&lt; '\\n'; \/\/ case 2\r\n\telse\r\n\t\tstd::cout &lt;&lt; x &lt;&lt; \" is equal to \" &lt;&lt; y &lt;&lt; '\\n'; \/\/ case 3\r\n}<\/code><\/pre>\n<p>3 calls are needed to get 100% branch coverage here: <code>compare(1, 0)<\/code> tests the positive use case for the first <code>if statement<\/code>.  <code>compare(0, 1)<\/code> tests the negative use case for the first <code>if statement<\/code> and the positive use case for the second <code>if statement<\/code>.  <code>compare(0, 0)<\/code> tests the negative use case for the first and second <code>if statement<\/code> and executes the <code>else statement<\/code>.  Thus, we can say this function is reliably tested with 3 calls (which is slightly better than 18 quintillion).<\/p>\n<div class=\"cpp-note cpp-lightgreenbackground\">\n<p class=\"cpp-note-title cpp-bottomline\">Best practice<\/p>\n<p>Aim for 100% branch coverage of your code.\n<\/p><\/div>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Loop coverage<\/p>\n<p><strong>Loop coverage<\/strong> (informally called <strong>the 0, 1, 2 test<\/strong>) says that if you have a loop in your code, you should ensure it works properly when it iterates 0 times, 1 time, and 2 times.  If it works correctly for the 2-iteration case, it should work correctly for all iterations greater than 2.  These three tests therefore cover all possibilities (since a loop can&#8217;t execute a negative number of times).<\/p>\n<p>Consider:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">#include &lt;iostream&gt;\r\n\r\nvoid spam(int timesToPrint)\r\n{\r\n    for (int count{ 0 }; count &lt; timesToPrint; ++count)\r\n         std::cout &lt;&lt; \"Spam! \";\r\n}<\/code><\/pre>\n<p>To test the loop within this function properly, you should call it three times: <code>spam(0)<\/code> to test the zero-iteration case, <code>spam(1)<\/code> to test the one-iteration case, and <code>spam(2)<\/code> to test the two-iteration case.  If <code>spam(2)<\/code> works, then <code>spam(n)<\/code> should work, where <code>n &gt; 2<\/code>.<\/p>\n<div class=\"cpp-note cpp-lightgreenbackground\">\n<p class=\"cpp-note-title cpp-bottomline\">Best practice<\/p>\n<p>Use the <code>0, 1, 2 test<\/code> to ensure your loops work correctly with different number of iterations.\n<\/div>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Testing different categories of input<\/p>\n<p>When writing functions that accept parameters, or when accepting user input, consider what happens with different categories of input.  In this context, we&#8217;re using the term &#8220;category&#8221; to mean a set of inputs that have similar characteristics.<\/p>\n<p>For example, if I wrote a function to produce the square root of an integer, what values would it make sense to test it with?  You&#8217;d probably start with some normal value, like <code>4<\/code>.  But it would also be a good idea to test with <code>0<\/code>, and a negative number.<\/p>\n<p>Here are some basic guidelines for category testing:<\/p>\n<p>For integers, make sure you&#8217;ve considered how your function handles negative values, zero, and positive values.  You should also check for overflow if that&#8217;s relevant.<\/p>\n<p>For floating point numbers, make sure you&#8217;ve considered how your function handles values that have precision issues (values that are slightly larger or smaller than expected).  Good <code>double<\/code> type values to test with are <code>0.1<\/code> and <code>-0.1<\/code> (to test numbers that are slightly larger than expected) and <code>0.7<\/code> and <code>-0.7<\/code> (to test numbers that are slightly smaller than expected).<\/p>\n<p>For strings, make sure you&#8217;ve considered how your function handles an empty string, an alphanumeric string, strings that have whitespace (leading, trailing, and inner), and strings that are all whitespace.<\/p>\n<p>If your function takes a pointer, don&#8217;t forget to test <code>nullptr<\/code> as well (don&#8217;t worry if this doesn&#8217;t make sense, we haven&#8217;t covered it yet).<\/p>\n<div class=\"cpp-note cpp-lightgreenbackground\">\n<p class=\"cpp-note-title cpp-bottomline\">Best practice<\/p>\n<p>Test different categories of input values to make sure your unit handles them properly.\n<\/p><\/div>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Quiz time<\/p>\n<div class=\"quiz\" style=\"clear: both\">\n<p class=\"quiz-header\">Question #1<\/p>\n<p>\nWhat is branch coverage?<\/p>\n<p><a class=\"solution_link_show\" href=\"javascript:void(0)\" onclick=\"cppSolutionToggle(document.getElementById('cpp_solution_id_0'), this, 'Show Solution', 'Hide Solution')\">Show Solution<\/a><\/p>\n<div class=\"wpsolution\" id=\"cpp_solution_id_0\" style=\"display:none\">\nBranch coverage is the percentage of branches that have been executed, with the affirmative case and negative case counting separately.<\/div>\n<\/p>\n<\/div>\n<div class=\"quiz\" style=\"clear: both\">\n<p class=\"quiz-header\">Question #2<\/p>\n<p>\nHow many tests would the following function need to minimally validate that it works?<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">bool isLowerVowel(char c, bool yIsVowel)\r\n{\r\n    switch (c)\r\n    {\r\n    case 'a':\r\n    case 'e':\r\n    case 'i':\r\n    case 'o':\r\n    case 'u':\r\n        return true;\r\n    case 'y':\r\n        return yIsVowel;\r\n    default:\r\n        return false;\r\n    }\r\n}<\/code><\/pre>\n<p><a class=\"solution_link_show\" href=\"javascript:void(0)\" onclick=\"cppSolutionToggle(document.getElementById('cpp_solution_id_1'), this, 'Show Solution', 'Hide Solution')\">Show Solution<\/a><\/p>\n<div class=\"wpsolution\" id=\"cpp_solution_id_1\" style=\"display:none\">\n4 tests.  One to test the a\/e\/i\/o\/u case.  One to test the default case.  One to test <code>isLowerVowel('y', true)<\/code>.  And one to test <code>isLowerVowel('y', false)<\/code>.<\/div>\n<\/p>\n<\/div>\n<div class=\"prevnext\"><div class=\"prevnext-inline\">\n\t<a class=\"nav-link\" href=\"https:\/\/www.learncpp.com\/cpp-tutorial\/common-semantic-errors-in-c\/\">\n <div class=\"nav-button nav-button-next\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-chevron-circle-right\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Next lesson<\/div>\n      <div class=\"nav-button-lesson\">\n        <span class=\"nav-button-lesson-number\">9.3<\/span>Common semantic errors in C++\n      <\/div>\n    <\/div>\n  <\/div><\/a>\n  \t<a class=\"nav-link\" href=\"\/\">\n  <div class=\"nav-button nav-button-index\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-home\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Back to table of contents<\/div>\n    <\/div>\n<\/div><\/a>\n  \t<a class=\"nav-link\" href=\"https:\/\/www.learncpp.com\/cpp-tutorial\/introduction-to-testing-your-code\/\">\n  <div class=\"nav-button nav-button-prev\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-chevron-circle-left\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Previous lesson<\/div>\n      <div class=\"nav-button-lesson\">\n        <span class=\"nav-button-lesson-number\">9.1<\/span>Introduction to testing your code\n      <\/div>\n    <\/div>\n  <\/div><\/a>\n  <\/div><\/div>\n","protected":false},"excerpt":{"rendered":"<p>In the previous lesson , we discussed how to write and preserve simple tests. In this lesson, we&#8217;ll talk about what kind of tests are useful to write to ensure your code is correct. The term is used to describe how much of the source code of a program is &hellip;<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[3],"tags":[],"_links":{"self":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/10562"}],"collection":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/comments?post=10562"}],"version-history":[{"count":16,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/10562\/revisions"}],"predecessor-version":[{"id":18013,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/10562\/revisions\/18013"}],"wp:attachment":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/media?parent=10562"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/categories?post=10562"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/tags?post=10562"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}