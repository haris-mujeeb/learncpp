{"id":14432,"date":"2023-05-30T17:18:42","date_gmt":"2023-05-31T00:18:42","guid":{"rendered":"https:\/\/www.learncpp.com\/?p=14432"},"modified":"2024-03-05T10:34:42","modified_gmt":"2024-03-05T18:34:42","slug":"constexpr-if-statements","status":"publish","type":"post","link":"https:\/\/www.learncpp.com\/cpp-tutorial\/constexpr-if-statements\/","title":{"rendered":"8.4 &#8212; Constexpr if statements"},"content":{"rendered":"<p>Normally, the conditional of an if-statement is evaluated at runtime.<\/p>\n<p>However, consider the case where the conditional is a constant expression, such as in the following example:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">#include &lt;iostream&gt;\r\n\r\nint main()\r\n{\r\n\tconstexpr double gravity{ 9.8 };\r\n\r\n\t\/\/ reminder: low-precision floating point literals of the same type can be tested for equality\r\n\tif (gravity == 9.8) \/\/ constant expression, always true\r\n\t\tstd::cout &lt;&lt; \"Gravity is normal.\\n\";   \/\/ will always be executed\r\n\telse\r\n\t\tstd::cout &lt;&lt; \"We are not on Earth.\\n\"; \/\/ will never be executed\r\n\r\n\treturn 0;\r\n}<\/code><\/pre>\n<p>Because <code>gravity<\/code> is constexpr and initialized with value <code>9.8<\/code>, the conditional <code>gravity == 9.8<\/code> must evaluate to <code>true<\/code>.  As a result, the else-statement will never be executed.<\/p>\n<p>Evaluating a constexpr conditional at runtime is wasteful (since the result will never vary).  It is also wasteful to compile code into the executable that can never be executed.<\/p>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Constexpr if statements <span class=\"cpp-section-pill cpp-section-standard\">C++17<\/span><\/p>\n<p>C++17 introduces the <strong>constexpr if statement<\/strong>, which requires the conditional to be a constant expression.  The conditional of a constexpr-if-statement will be evaluated at compile-time.<\/p>\n<p>If the constexpr conditional evaluates to <code>true<\/code>, the entire if-else will be replaced by the true-statement.  If the constexpr conditional evaluates to <code>false<\/code>, the entire if-else will be replaced by the false-statement (if it exists) or nothing (if there is no else).<\/p>\n<p>To use a constexpr-if-statement, we add the <code>constexpr<\/code> keyword after the <code>if<\/code>:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">#include &lt;iostream&gt;\r\n\r\nint main()\r\n{\r\n\tconstexpr double gravity{ 9.8 };\r\n\r\n\tif constexpr (gravity == 9.8) \/\/ now using constexpr if\r\n\t\tstd::cout &lt;&lt; \"Gravity is normal.\\n\";\r\n\telse\r\n\t\tstd::cout &lt;&lt; \"We are not on Earth.\\n\";\r\n\r\n\treturn 0;\r\n}<\/code><\/pre>\n<p>When the above code is compiled, the compiler will evaluate the conditional at compile time, see that it is always <code>true<\/code>, and keep only the single statement <code>std::cout &lt;&lt; \"Gravity is normal.\\n\";<\/code>.<\/p>\n<p>In other words, it will compile this:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">int main()\r\n{\r\n\tconstexpr double gravity{ 9.8 };\r\n\r\n\tstd::cout &lt;&lt; \"Gravity is normal.\\n\";\r\n\r\n\treturn 0;\r\n}<\/code><\/pre>\n<div class=\"cpp-note cpp-lightgreenbackground\">\n<p class=\"cpp-note-title cpp-bottomline\">Best practice<\/p>\n<p>Favor constexpr if statements over non-constexpr if statements when the conditional is a constant expression.\n<\/p><\/div>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Modern compilers and if statements with constexpr conditionals <span class=\"cpp-section-pill cpp-section-standard\">C++17<\/span><\/p>\n<p>For optimization purposes, modern compilers will generally treat non-constexpr if-statements that have constexpr conditionals as if they were constexpr-if-statements.  However, they are not required to do so.<\/p>\n<p>A compiler that encounters a non-constexpr if-statement with a constexpr conditional may issue a warning advising you to use <code>if constexpr<\/code> instead.  This will ensure that compile-time evaluation will occur (even if optimizations are disabled).<\/p>\n<div class=\"prevnext\"><div class=\"prevnext-inline\">\n\t<a class=\"nav-link\" href=\"https:\/\/www.learncpp.com\/cpp-tutorial\/switch-statement-basics\/\">\n <div class=\"nav-button nav-button-next\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-chevron-circle-right\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Next lesson<\/div>\n      <div class=\"nav-button-lesson\">\n        <span class=\"nav-button-lesson-number\">8.5<\/span>Switch statement basics\n      <\/div>\n    <\/div>\n  <\/div><\/a>\n  \t<a class=\"nav-link\" href=\"\/\">\n  <div class=\"nav-button nav-button-index\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-home\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Back to table of contents<\/div>\n    <\/div>\n<\/div><\/a>\n  \t<a class=\"nav-link\" href=\"https:\/\/www.learncpp.com\/cpp-tutorial\/common-if-statement-problems\/\">\n  <div class=\"nav-button nav-button-prev\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-chevron-circle-left\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Previous lesson<\/div>\n      <div class=\"nav-button-lesson\">\n        <span class=\"nav-button-lesson-number\">8.3<\/span>Common if statement problems\n      <\/div>\n    <\/div>\n  <\/div><\/a>\n  <\/div><\/div>\n","protected":false},"excerpt":{"rendered":"<p>Normally, the conditional of an if-statement is evaluated at runtime. However, consider the case where the conditional is a constant expression, such as in the following example: #include &lt;iostream&gt; int main() { constexpr double gravity{ 9.8 }; \/\/ reminder: low-precision floating point literals of the same type can be tested &hellip;<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[3],"tags":[],"_links":{"self":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/14432"}],"collection":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/comments?post=14432"}],"version-history":[{"count":7,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/14432\/revisions"}],"predecessor-version":[{"id":16733,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/14432\/revisions\/16733"}],"wp:attachment":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/media?parent=14432"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/categories?post=14432"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/tags?post=14432"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}