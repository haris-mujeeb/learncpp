{"id":10559,"date":"2020-12-21T11:20:13","date_gmt":"2020-12-21T19:20:13","guid":{"rendered":"https:\/\/www.learncpp.com\/?p=10559"},"modified":"2024-09-01T14:53:27","modified_gmt":"2024-09-01T21:53:27","slug":"switch-fallthrough-and-scoping","status":"publish","type":"post","link":"https:\/\/www.learncpp.com\/cpp-tutorial\/switch-fallthrough-and-scoping\/","title":{"rendered":"8.6 &#8212; Switch fallthrough and scoping"},"content":{"rendered":"<p>This lesson continues our exploration of switch statements that we started in the prior lesson <a href=\"https:\/\/www.learncpp.com\/cpp-tutorial\/switch-statement-basics\/\">8.5 -- Switch statement basics<\/a>.  In the prior lesson, we mentioned that each set of statements underneath a label should end in a <code>break statement<\/code> or a <code>return statement<\/code>.<\/p>\n<p>In this lesson, we&#8217;ll explore why, and talk about some switch scoping issues that sometimes trip up new programmers.<\/p>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Fallthrough<\/p>\n<p>When a switch expression matches a case label or optional default label, execution begins at the first statement following the matching label.  Execution will then continue sequentially until one of the following termination conditions happens:<\/p>\n<ul>\n<li>The end of the switch block is reached.\n<\/li>\n<li>Another control flow statement (typically a <code>break<\/code> or <code>return<\/code>) causes the switch block or function to exit.\n<\/li>\n<li>Something else interrupts the normal flow of the program (e.g. the OS shuts the program down, the universe implodes, etc&#8230;)\n<\/li>\n<\/ul>\n<p>Note that the presence of another case label is <em>not<\/em> one of these terminating conditions -- thus, without a <code>break<\/code> or <code>return<\/code>, execution will overflow into subsequent cases.<\/p>\n<p>Here is a program that exhibits this behavior:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">#include &lt;iostream&gt;\r\n\r\nint main()\r\n{\r\n    switch (2)\r\n    {\r\n    case 1: \/\/ Does not match\r\n        std::cout &lt;&lt; 1 &lt;&lt; '\\n'; \/\/ Skipped\r\n    case 2: \/\/ Match!\r\n        std::cout &lt;&lt; 2 &lt;&lt; '\\n'; \/\/ Execution begins here\r\n    case 3:\r\n        std::cout &lt;&lt; 3 &lt;&lt; '\\n'; \/\/ This is also executed\r\n    case 4:\r\n        std::cout &lt;&lt; 4 &lt;&lt; '\\n'; \/\/ This is also executed\r\n    default:\r\n        std::cout &lt;&lt; 5 &lt;&lt; '\\n'; \/\/ This is also executed\r\n    }\r\n\r\n    return 0;\r\n}<\/code><\/pre>\n<p>This program outputs the following:<\/p>\n<pre>\n2\r\n3\r\n4\r\n5\r\n<\/pre>\n<p>This is probably not what we wanted!  When execution flows from a statement underneath a label into statements underneath a subsequent label, this is called <strong>fallthrough<\/strong>.  <\/p>\n<div class=\"cpp-note cpp-lightredbackground\">\n<p class=\"cpp-note-title cpp-bottomline\">Warning<\/p>\n<p>Once the statements underneath a case or default label have started executing, they will overflow (fallthrough) into subsequent cases.  break or return statements are typically used to prevent this.\n<\/p><\/div>\n<p>Since fallthrough is rarely desired or intentional, many compilers and code analysis tools will flag fallthrough as a warning.<\/p>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">The [[fallthrough]] attribute<\/p>\n<p>Commenting intentional fallthrough is a common convention to tell other developers that fallthrough is intended.  While this works for other developers, the compiler and code analysis tools don&#8217;t know how to interpret comments, so it won&#8217;t get rid of the warnings.<\/p>\n<p>To help address this, C++17 adds a new attribute called <code>[[fallthrough]]<\/code>.<\/p>\n<p><strong>Attributes<\/strong> are a modern C++ feature that allows the programmer to provide the compiler with some additional data about the code.  To specify an attribute, the attribute name is placed between double brackets.  Attributes are not statements -- rather, they can be used almost anywhere where they are contextually relevant.<\/p>\n<p>The <code>[[fallthrough]]<\/code> attribute modifies a <code>null statement<\/code> to indicate that fallthrough is intentional (and no warnings should be triggered):<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">#include &lt;iostream&gt;\r\n\r\nint main()\r\n{\r\n    switch (2)\r\n    {\r\n    case 1:\r\n        std::cout &lt;&lt; 1 &lt;&lt; '\\n';\r\n        break;\r\n    case 2:\r\n        std::cout &lt;&lt; 2 &lt;&lt; '\\n'; \/\/ Execution begins here\r\n        [[fallthrough]]; \/\/ intentional fallthrough -- note the semicolon to indicate the null statement\r\n    case 3:\r\n        std::cout &lt;&lt; 3 &lt;&lt; '\\n'; \/\/ This is also executed\r\n        break;\r\n    }\r\n\r\n    return 0;\r\n}<\/code><\/pre>\n<p>This program prints:<\/p>\n<pre>\r\n2\r\n3\r\n<\/pre>\n<p>And it should not generate any warnings about the fallthrough.<\/p>\n<div class=\"cpp-note cpp-lightgreenbackground\">\n<p class=\"cpp-note-title cpp-bottomline\">Best practice<\/p>\n<p>Use the <code>[[fallthrough]]<\/code> attribute (along with a null statement) to indicate intentional fallthrough.\n<\/div>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Sequential case labels<\/p>\n<p>You can use the logical OR operator to combine multiple tests into a single statement:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">bool isVowel(char c)\r\n{\r\n    return (c=='a' || c=='e' || c=='i' || c=='o' || c=='u' ||\r\n        c=='A' || c=='E' || c=='I' || c=='O' || c=='U');\r\n}<\/code><\/pre>\n<p>This suffers from the same challenges that we presented in the introduction to switch statements: <code>c<\/code> gets evaluated multiple times and the reader has to make sure it is <code>c<\/code> that is being evaluated each time.<\/p>\n<p>You can do something similar using switch statements by placing multiple case labels in sequence:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">bool isVowel(char c)\r\n{\r\n    switch (c)\r\n    {\r\n    case 'a': \/\/ if c is 'a'\r\n    case 'e': \/\/ or if c is 'e'\r\n    case 'i': \/\/ or if c is 'i'\r\n    case 'o': \/\/ or if c is 'o'\r\n    case 'u': \/\/ or if c is 'u'\r\n    case 'A': \/\/ or if c is 'A'\r\n    case 'E': \/\/ or if c is 'E'\r\n    case 'I': \/\/ or if c is 'I'\r\n    case 'O': \/\/ or if c is 'O'\r\n    case 'U': \/\/ or if c is 'U'\r\n        return true;\r\n    default:\r\n        return false;\r\n    }\r\n}<\/code><\/pre>\n<p>Remember, execution begins at the first statement after a matching case label.  Case labels aren&#8217;t statements (they&#8217;re labels), so they don&#8217;t count.<\/p>\n<p>The first statement after <em>all<\/em> of the case statements in the above program is <code>return true<\/code>, so if any case labels match, the function will return <code>true<\/code>.<\/p>\n<p>Thus, we can &#8220;stack&#8221; case labels to make all of those case labels share the same set of statements afterward.  This is not considered fallthrough behavior, so use of comments or <code>[[fallthrough]]<\/code> is not needed here.<\/p>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Labels do not define a new scope<\/p>\n<p>With <code>if statements<\/code>, you can only have a single statement after the if-condition, and that statement is considered to be implicitly inside a block:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">if (x &gt; 10)\r\n    std::cout &lt;&lt; x &lt;&lt; \" is greater than 10\\n\"; \/\/ this line implicitly considered to be inside a block<\/code><\/pre>\n<p>However, with switch statements, the statements after labels are all scoped to the switch block.  No implicit blocks are created.<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">switch (1)\r\n{\r\ncase 1: \/\/ does not create an implicit block\r\n    foo(); \/\/ this is part of the switch scope, not an implicit block to case 1\r\n    break; \/\/ this is part of the switch scope, not an implicit block to case 1\r\ndefault:\r\n    std::cout &lt;&lt; \"default case\\n\";\r\n    break;\r\n}<\/code><\/pre>\n<p>In the above example, the 2 statements between the <code>case 1<\/code> and the default label are scoped as part of the switch block, not a block implicit to <code>case 1<\/code>.<\/p>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Variable declaration and initialization inside case statements<\/p>\n<p>You can declare or define (but not initialize) variables inside the switch, both before and after the case labels:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">switch (1)\r\n{\r\n    int a; \/\/ okay: definition is allowed before the case labels\r\n    int b{ 5 }; \/\/ illegal: initialization is not allowed before the case labels\r\n\r\ncase 1:\r\n    int y; \/\/ okay but bad practice: definition is allowed within a case\r\n    y = 4; \/\/ okay: assignment is allowed\r\n    break;\r\n\r\ncase 2:\r\n    int z{ 4 }; \/\/ illegal: initialization is not allowed if subsequent cases exist\r\n    y = 5; \/\/ okay: y was declared above, so we can use it here too\r\n    break;\r\n\r\ncase 3:\r\n    break;\r\n}<\/code><\/pre>\n<p>Although variable <code>y<\/code> was defined in <code>case 1<\/code>, it was used in <code>case 2<\/code> as well.  All statements inside the switch are considered to be part of the same scope.  Thus, a variable declared or defined in one case can be used in a later case, even if the case in which the variable is defined is never executed (because the switch jumped over it)!<\/p>\n<p>However, initialization of variables <em>does<\/em> require the definition to execute.  Initialization of variables is disallowed in any case that is not the last case (because the switch could jump over the initializer if there is a subsequent case defined, in which case the variable would be undefined, and accessing it would result in undefined behavior).  Initialization is also disallowed before the first case, as those statements will never be executed, as there is no way for the switch to reach them.<\/p>\n<p>If a case needs to define and\/or initialize a new variable, the best practice is to do so inside an explicit block underneath the case statement:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">switch (1)\r\n{\r\ncase 1:\r\n{ \/\/ note addition of explicit block here\r\n    int x{ 4 }; \/\/ okay, variables can be initialized inside a block inside a case\r\n    std::cout &lt;&lt; x;\r\n    break;\r\n}\r\n\r\ndefault:\r\n    std::cout &lt;&lt; \"default case\\n\";\r\n    break;\r\n}<\/code><\/pre>\n<div class=\"cpp-note cpp-lightgreenbackground\">\n<p class=\"cpp-note-title cpp-bottomline\">Best practice<\/p>\n<p>If defining variables used in a case statement, do so in a block inside the case.\n<\/p><\/div>\n<p class=\"cpp-section cpp-topline\" style=\"clear: both\">Quiz time<\/p>\n<p class=\"cpp-quiz-question\" style=\"clear: both\">Question #1<\/p>\n<p>Write a function called calculate() that takes two integers and a char representing one of the following mathematical operations: +, -, *, \/, or % (remainder). Use a switch statement to perform the appropriate mathematical operation on the integers, and return the result. If an invalid operator is passed into the function, the function should print an error message.  For the division operator, do an integer division, and don&#8217;t worry about divide by zero.<\/p>\n<p>Hint: &#8220;operator&#8221; is a keyword, variables can&#8217;t be named &#8220;operator&#8221;.<\/p>\n<p><a class=\"solution_link_show\" href=\"javascript:void(0)\" onclick=\"cppSolutionToggle(document.getElementById('cpp_solution_id_0'), this, 'Show Solution', 'Hide Solution')\">Show Solution<\/a><\/p>\n<div class=\"wpsolution\" id=\"cpp_solution_id_0\" style=\"display:none\">\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">#include &lt;iostream&gt;\r\n\r\nint calculate(int x, int y, char op)\r\n{\r\n    switch (op)\r\n    {\r\n    case '+':\r\n        return x + y;\r\n    case '-':\r\n        return x - y;\r\n    case '*':\r\n        return x * y;\r\n    case '\/':\r\n        return x \/ y;\r\n    case '%':\r\n        return x % y;\r\n    default:\r\n        std::cout &lt;&lt; \"calculate(): Unhandled case\\n\";\r\n        return 0;\r\n    }\r\n}\r\n\r\nint main()\r\n{\r\n    std::cout &lt;&lt; \"Enter an integer: \";\r\n    int x{};\r\n    std::cin &gt;&gt; x;\r\n\r\n    std::cout &lt;&lt; \"Enter another integer: \";\r\n    int y{};\r\n    std::cin &gt;&gt; y;\r\n\r\n    std::cout &lt;&lt; \"Enter a mathematical operator (+, -, *, \/, or %): \";\r\n    char op{};\r\n    std::cin &gt;&gt; op;\r\n\r\n    \/\/ We'll call calculate first so an invalid operator prints an error message on its own line\r\n    int result{ calculate(x, y, op) };\r\n    std::cout &lt;&lt; x &lt;&lt; ' ' &lt;&lt; op &lt;&lt; ' ' &lt;&lt; y &lt;&lt; \" is \" &lt;&lt; result &lt;&lt; '\\n';\r\n\r\n    return 0;\r\n}<\/code><\/pre>\n<\/div>\n<div class=\"prevnext\"><div class=\"prevnext-inline\">\n\t<a class=\"nav-link\" href=\"https:\/\/www.learncpp.com\/cpp-tutorial\/goto-statements\/\">\n <div class=\"nav-button nav-button-next\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-chevron-circle-right\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Next lesson<\/div>\n      <div class=\"nav-button-lesson\">\n        <span class=\"nav-button-lesson-number\">8.7<\/span>Goto statements\n      <\/div>\n    <\/div>\n  <\/div><\/a>\n  \t<a class=\"nav-link\" href=\"\/\">\n  <div class=\"nav-button nav-button-index\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-home\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Back to table of contents<\/div>\n    <\/div>\n<\/div><\/a>\n  \t<a class=\"nav-link\" href=\"https:\/\/www.learncpp.com\/cpp-tutorial\/switch-statement-basics\/\">\n  <div class=\"nav-button nav-button-prev\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-chevron-circle-left\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Previous lesson<\/div>\n      <div class=\"nav-button-lesson\">\n        <span class=\"nav-button-lesson-number\">8.5<\/span>Switch statement basics\n      <\/div>\n    <\/div>\n  <\/div><\/a>\n  <\/div><\/div>\n","protected":false},"excerpt":{"rendered":"<p>This lesson continues our exploration of switch statements that we started in the prior lesson . In the prior lesson, we mentioned that each set of statements underneath a label should end in a break statement or a return statement. In this lesson, we&#8217;ll explore why, and talk about some &hellip;<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[3],"tags":[],"_links":{"self":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/10559"}],"collection":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/comments?post=10559"}],"version-history":[{"count":27,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/10559\/revisions"}],"predecessor-version":[{"id":17539,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/10559\/revisions\/17539"}],"wp:attachment":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/media?parent=10559"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/categories?post=10559"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/tags?post=10559"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}