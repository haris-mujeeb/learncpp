{"id":167,"date":"2008-01-07T16:18:44","date_gmt":"2008-01-08T00:18:44","guid":{"rendered":"http:\/\/www.learncpp.com\/cpp-programming\/113-order-of-construction-in-derived-classes\/"},"modified":"2024-04-30T12:16:59","modified_gmt":"2024-04-30T19:16:59","slug":"order-of-construction-of-derived-classes","status":"publish","type":"post","link":"https:\/\/www.learncpp.com\/cpp-tutorial\/order-of-construction-of-derived-classes\/","title":{"rendered":"24.3 &#8212; Order of construction of derived classes"},"content":{"rendered":"<p>In the previous lesson on <a href=\"http:\/\/www.learncpp.com\/cpp-tutorial\/112-basic-inheritance-in-c\/\">basic inheritance in C++<\/a>, you learned that classes can inherit members and functions from other classes.  In this lesson, we&#8217;re going to take a closer look at the order of construction that happens when a derived class is instantiated.<\/p>\n<p>First, let&#8217;s introduce some new classes that will help us illustrate some important points.<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">class Base\r\n{\r\npublic:\r\n    int m_id {};\r\n\r\n    Base(int id=0)\r\n        : m_id { id }\r\n    {\r\n    }\r\n\r\n    int getId() const { return m_id; }\r\n};\r\n\r\nclass Derived: public Base\r\n{\r\npublic:\r\n    double m_cost {};\r\n\r\n    Derived(double cost=0.0)\r\n        : m_cost { cost }\r\n    {\r\n    }\r\n\r\n    double getCost() const { return m_cost; }\r\n};<\/code><\/pre>\n<p>In this example, class Derived is derived from class Base.<\/p>\n<p><img src=\"http:\/\/www.learncpp.com\/images\/CppTutorial\/Section11\/DerivedBase.gif\"><\/p>\n<p>Because Derived inherits functions and variables from Base, you may assume that the members of Base are copied into Derived.  However, this is not true.  Instead, we can consider Derived as a two part class: one part Derived, and one part Base.<\/p>\n<p><img src=\"http:\/\/www.learncpp.com\/images\/CppTutorial\/Section11\/DerivedBaseCombined.gif\"><\/p>\n<p>You&#8217;ve already seen plenty examples of what happens when we instantiate a normal (non-derived) class:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">int main()\r\n{\r\n    Base base;\r\n\r\n    return 0;\r\n}<\/code><\/pre>\n<p>Base is a non-derived class because it does not inherit from any other classes.  C++ allocates memory for Base, then calls Base&#8217;s default constructor to do the initialization.  <\/p>\n<p>Now let&#8217;s take a look at what happens when we instantiate a derived class:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">int main()\r\n{\r\n    Derived derived;\r\n\r\n    return 0;\r\n}<\/code><\/pre>\n<p>If you were to try this yourself, you wouldn&#8217;t notice any difference from the previous example where we instantiate non-derived class Base.  But behind the scenes, things happen slightly differently.  As mentioned above, Derived is really two parts: a Base part, and a Derived part.  When C++ constructs derived objects, it does so in phases.  First, the most-base class (at the top of the inheritance tree) is constructed.  Then each child class is constructed in order, until the most-child class (at the bottom of the inheritance tree) is constructed last.<\/p>\n<p>So when we instantiate an instance of Derived, first the Base portion of Derived is constructed (using the Base default constructor).  Once the Base portion is finished, the Derived portion is constructed (using the Derived default constructor).  At this point, there are no more derived classes, so we are done.<\/p>\n<p>This process is actually easy to illustrate.<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">#include &lt;iostream&gt;\r\n\r\nclass Base\r\n{\r\npublic:\r\n    int m_id {};\r\n\r\n    Base(int id=0)\r\n        : m_id { id }\r\n    {\r\n        std::cout &lt;&lt; \"Base\\n\";\r\n    }\r\n\r\n    int getId() const { return m_id; }\r\n};\r\n\r\nclass Derived: public Base\r\n{\r\npublic:\r\n    double m_cost {};\r\n\r\n    Derived(double cost=0.0)\r\n        : m_cost { cost }\r\n    {\r\n        std::cout &lt;&lt; \"Derived\\n\";\r\n    }\r\n\r\n    double getCost() const { return m_cost; }\r\n};\r\n\r\nint main()\r\n{\r\n    std::cout &lt;&lt; \"Instantiating Base\\n\";\r\n    Base base;\r\n\r\n    std::cout &lt;&lt; \"Instantiating Derived\\n\";\r\n    Derived derived;\r\n\r\n    return 0;\r\n}<\/code><\/pre>\n<p>This program produces the following result:<\/p>\n<pre>\r\nInstantiating Base\r\nBase\r\nInstantiating Derived\r\nBase\r\nDerived\r\n<\/pre>\n<p>As you can see, when we constructed Derived, the Base portion of Derived got constructed first.  This makes sense: logically, a child can not exist without a parent.  It&#8217;s also the safe way to do things: the child class often uses variables and functions from the parent, but the parent class knows nothing about the child.  Instantiating the parent class first ensures those variables are already initialized by the time the derived class is created and ready to use them.<\/p>\n<p><strong>Order of construction for inheritance chains<\/strong><\/p>\n<p>It is sometimes the case that classes are derived from other classes, which are themselves derived from other classes.  For example:<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">#include &lt;iostream&gt;\r\n\r\nclass A\r\n{\r\npublic:\r\n    A()\r\n    {\r\n        std::cout &lt;&lt; \"A\\n\";\r\n    }\r\n};\r\n\r\nclass B: public A\r\n{\r\npublic:\r\n    B()\r\n    {\r\n        std::cout &lt;&lt; \"B\\n\";\r\n    }\r\n};\r\n\r\nclass C: public B\r\n{\r\npublic:\r\n    C()\r\n    {\r\n        std::cout &lt;&lt; \"C\\n\";\r\n    }\r\n};\r\n\r\nclass D: public C\r\n{\r\npublic:\r\n    D()\r\n    {\r\n        std::cout &lt;&lt; \"D\\n\";\r\n    }\r\n};<\/code><\/pre>\n<p>Remember that C++ always constructs the &#8220;first&#8221; or &#8220;most base&#8221; class first.  It then walks through the inheritance tree in order and constructs each successive derived class.  <\/p>\n<p>Here&#8217;s a short program that illustrates the order of creation all along the inheritance chain.<\/p>\n<pre class=\"language-cpp line-numbers\"><code class=\"language-cpp match-braces\">int main()\r\n{\r\n    std::cout &lt;&lt; \"Constructing A: \\n\";\r\n    A a;\r\n\r\n    std::cout &lt;&lt; \"Constructing B: \\n\";\r\n    B b;\r\n\r\n    std::cout &lt;&lt; \"Constructing C: \\n\";\r\n    C c;\r\n\r\n    std::cout &lt;&lt; \"Constructing D: \\n\";\r\n    D d;\r\n}<\/code><\/pre>\n<p>This code prints the following:<\/p>\n<pre>\r\nConstructing A:\r\nA\r\nConstructing B:\r\nA\r\nB\r\nConstructing C:\r\nA\r\nB\r\nC\r\nConstructing D:\r\nA\r\nB\r\nC\r\nD\r\n<\/pre>\n<p><strong>Conclusion<\/strong><\/p>\n<p>C++ constructs derived classes in phases, starting with the most-base class (at the top of the inheritance tree) and finishing with the most-child class (at the bottom of the inheritance tree).  As each class is constructed, the appropriate constructor from that class is called to initialize that part of the class.<\/p>\n<p>You will note that our example classes in this section have all used base class default constructors (for simplicity).  In the next lesson, we will take a closer look at the role of constructors in the process of constructing derived classes (including how to explicitly choose which base class constructor you want your derived class to use).<\/p>\n<div class=\"prevnext\"><div class=\"prevnext-inline\">\n\t<a class=\"nav-link\" href=\"https:\/\/www.learncpp.com\/cpp-tutorial\/constructors-and-initialization-of-derived-classes\/\">\n <div class=\"nav-button nav-button-next\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-chevron-circle-right\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Next lesson<\/div>\n      <div class=\"nav-button-lesson\">\n        <span class=\"nav-button-lesson-number\">24.4<\/span>Constructors and initialization of derived classes\n      <\/div>\n    <\/div>\n  <\/div><\/a>\n  \t<a class=\"nav-link\" href=\"\/\">\n  <div class=\"nav-button nav-button-index\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-home\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Back to table of contents<\/div>\n    <\/div>\n<\/div><\/a>\n  \t<a class=\"nav-link\" href=\"https:\/\/www.learncpp.com\/cpp-tutorial\/basic-inheritance-in-c\/\">\n  <div class=\"nav-button nav-button-prev\">\n    <div class=\"nav-button-icon\"><i class=\"fa fa-chevron-circle-left\" aria-hidden=\"true\"><\/i><\/div>\n    <div class=\"nav-button-text\">\n      <div class=\"nav-button-title\">Previous lesson<\/div>\n      <div class=\"nav-button-lesson\">\n        <span class=\"nav-button-lesson-number\">24.2<\/span>Basic inheritance in C++\n      <\/div>\n    <\/div>\n  <\/div><\/a>\n  <\/div><\/div>\n","protected":false},"excerpt":{"rendered":"<p>In the previous lesson on basic inheritance in C++, you learned that classes can inherit members and functions from other classes. In this lesson, we&#8217;re going to take a closer look at the order of construction that happens when a derived class is instantiated. First, let&#8217;s introduce some new classes &hellip;<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[3],"tags":[],"_links":{"self":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/167"}],"collection":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/comments?post=167"}],"version-history":[{"count":16,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/167\/revisions"}],"predecessor-version":[{"id":16990,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/posts\/167\/revisions\/16990"}],"wp:attachment":[{"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/media?parent=167"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/categories?post=167"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.learncpp.com\/wp-json\/wp\/v2\/tags?post=167"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}